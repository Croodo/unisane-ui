# Gitleaks Configuration
# Documentation: https://github.com/gitleaks/gitleaks

title = "Unisane Monorepo Secret Scanning"

[extend]
# useDefault will extend the base configuration with additional custom rules
useDefault = true

[[rules]]
id = "stripe-secret-key"
description = "Stripe Secret Key"
regex = '''sk_(live|test)_[a-zA-Z0-9]{24,}'''
tags = ["key", "stripe"]

[[rules]]
id = "stripe-restricted-key"
description = "Stripe Restricted Key"
regex = '''rk_(live|test)_[a-zA-Z0-9]{24,}'''
tags = ["key", "stripe"]

[[rules]]
id = "aws-access-key-id"
description = "AWS Access Key ID"
regex = '''AKIA[0-9A-Z]{16}'''
tags = ["key", "aws"]

[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)api[_-]?key["\s:=]+([a-zA-Z0-9_\-]{32,})'''
tags = ["key", "api"]

[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[a-zA-Z0-9_-]+\.eyJ[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+'''
tags = ["token", "jwt"]

[[rules]]
id = "mongodb-connection-string"
description = "MongoDB Connection String with Password"
regex = '''mongodb(\+srv)?:\/\/[^:]+:[^@]+@'''
tags = ["connection-string", "mongodb"]

[[rules]]
id = "postgres-connection-string"
description = "PostgreSQL Connection String with Password"
regex = '''postgres:\/\/[^:]+:[^@]+@'''
tags = ["connection-string", "postgres"]

[[rules]]
id = "private-key"
description = "Private Key"
regex = '''-----BEGIN (RSA |EC )?PRIVATE KEY-----'''
tags = ["key", "private"]

# Allowlist: Paths to exclude from scanning
[allowlist]
description = "Allowlist for files and patterns that are safe to ignore"

# Exclude test files with mock secrets
paths = [
  '''\.test\.ts$''',
  '''\.spec\.ts$''',
  '''__tests__/''',
  '''__mocks__/''',
  '''/fixtures/''',
  '''/testdata/''',
  '''\.example$''',
  '''\.example\.''',
  '''\.template$''',
  '''\.sample$''',
]

# Exclude specific patterns that are false positives
regexes = [
  '''example\.com''',
  '''your-api-key-here''',
  '''your-secret-here''',
  '''<your-.*>''',
  '''{{.*}}''',
  '''\$\{.*\}''',
  '''process\.env\.''',
]

# Exclude documentation files
[[allowlist.paths]]
regex = '''(README|CHANGELOG|\.md)$'''
description = "Documentation files"

# Exclude lock files and generated files
[[allowlist.paths]]
regex = '''(package-lock|pnpm-lock|yarn\.lock)$'''
description = "Lock files"

[[allowlist.paths]]
regex = '''(node_modules|dist|build)/'''
description = "Generated directories"

# Specific allowlisted commits (if any historical commits contain test data)
# commits = [
#   "abcdef1234567890",
# ]
